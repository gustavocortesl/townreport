(function(){angular.module("townReportApp",["ngRoute","ngSanitize","ui.bootstrap"]);function e(e,t){e.when("/",{templateUrl:"home/home.view.html",controller:"homeCtrl",controllerAs:"vm"}).when("/about",{templateUrl:"/common/views/genericText.view.html",controller:"aboutCtrl",controllerAs:"vm"}).when("/contact",{templateUrl:"/common/views/genericText.view.html",controller:"contactCtrl",controllerAs:"vm"}).when("/problem/:problemid",{templateUrl:"/problemDetail/problemDetail.view.html",controller:"problemDetailCtrl",controllerAs:"vm"}).when("/register",{templateUrl:"/auth/register/register.view.html",controller:"registerCtrl",controllerAs:"vm"}).when("/login",{templateUrl:"/auth/login/login.view.html",controller:"loginCtrl",controllerAs:"vm"}).otherwise({redirectTo:"/"});t.html5Mode(true)}angular.module("townReportApp").config(["$routeProvider","$locationProvider",e])})();(function(){angular.module("townReportApp").controller("aboutCtrl",e);function e(){var e=this;e.pageHeader={title:"About TownReport"};e.main={content:"OUR MAIN GOAL: TO GET A BETTER PLACE TO LIVE\n\n"+"TownReport has been created to help local government to know where the problems are. This is achieved with the cooperation of citizens which can report any issue (breakdowns, flaws, etc.) and so alert town maintenance services about it. Those responsible for the maintenance of public facilities can allocate resources and track the progress of works.\n\n"+"The problems to be considered are those related to basic town facilities that can be categorized (electrical-power, water-supply, traffic facilities…). Examples are:\n"+"* An iron manhole cover that makes a noise when a vehicle passes over.\n"+"* A streetlamp with a broken bulb.\n"+"* A public fountain without water.\n"+"* A swing in a playground broken or damaged.\n\n"+"FEATURES\n"+"- The website show in a map the location of registered problems.\n"+"- The website show in a list the main data of registered problems.\n"+"- The problems to show can be filtered by category, state, date, user…\n"+"- Every problem reported have a details page you can open for more information.\n"+"- Citizens can register new problems and see the state of existing ones.\n"+"- Citizens can add comments or more information to any problem reported.\n"}}})();(function(){angular.module("townReportApp").controller("contactCtrl",e);function e(){var e=this;e.pageHeader={title:"Contact Us"};e.main={content:"OUR ADDRESS\n"+"FSWD Capstone Projects\n"+"Muppala Avenue 2016\n"+"40029 Adnor\n"+"Agalam (THE CLOUDSLAND)\n\n"+"PHONE NUMBERS\n"+"899 989 989\n"+"899 987 014\n\n"+"FAX NUMBER\n"+"899 987 015\n\n"+"EMAIL\n"+"contact@fswdcp.com\n"}}})();(function(){angular.module("townReportApp").controller("problemDetailCtrl",e);e.$inject=["$routeParams","$location","$uibModal","trData","authentication"];function e(e,t,r,o,n){var a=this;a.problemid=e.problemid;a.pageHeader={title:a.problemid};o.problemById(a.problemid).success(function(e){a.data={problem:e};a.data.mapsKey="AIzaSyBzMA1nW7Yg65GNj6R3rlIV4Gjch0v8QlE";a.pageHeader={title:a.data.problem.name}}).error(function(e){console.log(e);a.message="Sorry, something's gone wrong"});a.isLoggedIn=n.isLoggedIn();a.currentPath=t.path();a.popupCommentForm=function(){var e=r.open({templateUrl:"/commentModal/commentModal.view.html",controller:"commentModalCtrl as vm",resolve:{problemData:function(){return{problemid:a.problemid,problemName:a.data.problem.name}}}});e.result.then(function(e){a.data.problem.comments.push(e)})};a.popupStateChangeForm=function(){var e=r.open({templateUrl:"/stateChangeModal/stateChangeModal.view.html",controller:"stateChangeModalCtrl as vm",resolve:{problemData:function(){return{problemid:a.problemid,problemName:a.data.problem.name,problemState:a.data.problem.state}}}});e.result.then(function(e){a.data.problem.stateChanges.push(e);o.updateProblem(a.problemid,{state:e.state}).success(function(e){a.data.problem.state=e.state}).error(function(e){console.log("Error!");a.formError="Problem state has not been saved"})})}}})();(function(){angular.module("townReportApp").controller("problemModalCtrl",e);e.$inject=["$uibModalInstance","trData","newProblemData"];function e(e,t,r){var o=this;o.newProblemData=r;o.onSubmit=function(){o.formError="";if(!o.formData||!o.formData.name||!o.formData.category||!o.formData.state||!o.formData.description){o.formError="All fields required, please try again";return false}else{o.doAddProblem(o.newProblemData,o.formData)}};o.doAddProblem=function(e){t.addNewProblem({name:o.formData.name,category:o.formData.category,state:o.formData.state,description:o.formData.description,address:o.formData.address,priority:o.formData.priority,lng:o.newProblemData.lng,lat:o.newProblemData.lat}).success(function(e){o.modal.close(e)}).error(function(e){console.log("Error!");o.formError="Your problem has not been saved, try again"});return false};o.modal={close:function(t){e.close(t)},closeWithoutSave:function(){o.newProblemData.newMarker.setAnimation(google.maps.Animation.BOUNCE);e.dismiss("cancel")},cancel:function(){e.dismiss("cancel");o.newProblemData.deleteNewMarker()}}}})();(function(){angular.module("townReportApp").controller("commentModalCtrl",e);e.$inject=["$uibModalInstance","trData","problemData"];function e(e,t,r){var o=this;o.problemData=r;o.onSubmit=function(){o.formError="";if(!o.formData||!o.formData.commentText){o.formError="Comment text is required, please try again";return false}else{o.doAddComment(o.problemData.problemid,o.formData)}};o.doAddComment=function(e,r){t.addCommentById(e,{commentText:r.commentText}).success(function(e){o.modal.close(e)}).error(function(e){console.log("Error!");o.formError="Your comment has not been saved, try again"});return false};o.modal={close:function(t){e.close(t)},cancel:function(){e.dismiss("cancel")}}}})();(function(){angular.module("townReportApp").controller("stateChangeModalCtrl",e);e.$inject=["$uibModalInstance","trData","problemData"];function e(e,t,r){var o=this;o.problemData=r;o.onSubmit=function(){o.formError="";if(!o.formData||!o.formData.state||!o.formData.commentText){o.formError="All fields required, please try again";return false}else{o.doAddStateChange(o.problemData.problemid,o.formData)}};o.doAddStateChange=function(e,r){t.addStateChangeById(e,{state:r.state,commentText:r.commentText}).success(function(e){o.modal.close(e)}).error(function(e){console.log("Error!");o.formError="State change has not been saved, try again"});return false};o.modal={close:function(t){e.close(t)},cancel:function(){e.dismiss("cancel")}}}})();(function(){angular.module("townReportApp").controller("registerCtrl",e);e.$inject=["$location","authentication"];function e(e,t){var r=this;r.pageHeader={title:"Create a new TownReport account"};r.credentials={name:"",email:"",password:"",password2:""};r.returnPage=e.search().page||"/";r.onSubmit=function(){r.formError="";if(!r.credentials.name||!r.credentials.email||!r.credentials.password||!r.credentials.password2){r.formError="All fields required, please try again";return false}else if(r.credentials.password!==r.credentials.password2){r.formError="Passwords must be the same, please try again";return false}else{r.doRegister()}};r.doRegister=function(){r.formError="";t.register(r.credentials).error(function(e){r.formError=e}).then(function(){e.search("page",null);e.path(r.returnPage)})}}})();(function(){angular.module("townReportApp").controller("loginCtrl",e);e.$inject=["$location","authentication"];function e(e,t){var r=this;r.pageHeader={title:"Sign in to TownReport"};r.credentials={email:"",password:""};r.returnPage=e.search().page||"/";r.onSubmit=function(){r.formError="";if(!r.credentials.email||!r.credentials.password){r.formError="All fields required, please try again";return false}else{r.doLogin()}};r.doLogin=function(){r.formError="";t.login(r.credentials).error(function(e){r.formError=e}).then(function(){e.search("page",null);e.path(r.returnPage)})}}})();(function(){angular.module("townReportApp").service("geolocation",e);function e(){var e=function(e,t,r){if(navigator.geolocation){navigator.geolocation.getCurrentPosition(e,t)}else{r()}};return{getPosition:e}}})();(function(){angular.module("townReportApp").service("trData",e);e.$inject=["$http","authentication"];function e(e,t){var r=function(t,r){return e.get("/api/problems?lng="+r+"&lat="+t+"&maxDistance=100")};var o=function(t){return e.get("/api/problems/"+t)};var n=function(r){return e.post("/api/problems/",r,{headers:{Authorization:"Bearer "+t.getToken()}})};var a=function(r,o){return e.put("/api/problems/"+r,o,{headers:{Authorization:"Bearer "+t.getToken()}})};var i=function(r,o){return e.post("/api/problems/"+r+"/comments",o,{headers:{Authorization:"Bearer "+t.getToken()}})};var l=function(r,o){return e.post("/api/problems/"+r+"/statechanges",o,{headers:{Authorization:"Bearer "+t.getToken()}})};var s=function(t){return e.get("/api/config?var="+t)};return{problemsByCoords:r,problemById:o,addNewProblem:n,updateProblem:a,addCommentById:i,addStateChangeById:l,getVarValue:s}}})();(function(){angular.module("townReportApp").service("authentication",e);e.$inject=["$http","$window"];function e(e,t){var r=function(e){t.localStorage["townreport-token"]=e};var o=function(){return t.localStorage["townreport-token"]};var n=function(){var e=o();if(e){var r=JSON.parse(t.atob(e.split(".")[1]));return r.exp>Date.now()/1e3}else{return false}};var a=function(){if(n()){var e=o();var r=JSON.parse(t.atob(e.split(".")[1]));return{email:r.email,name:r.name,admin:r.admin}}};var i=function(t){return e.post("/api/register",t).success(function(e){r(e.token)})};var l=function(t){return e.post("/api/login",t).success(function(e){r(e.token)})};var s=function(){t.localStorage.removeItem("townreport-token")};return{saveToken:r,getToken:o,isLoggedIn:n,currentUser:a,register:i,login:l,logout:s}}})();(function(){angular.module("townReportApp").filter("formatDistance",t);var e=function(e){return!isNaN(parseFloat(e))&&isFinite(e)};function t(){return function(t){var r,o;if(t&&e(t)){if(t>1){r=parseFloat(t).toFixed(1);o="km"}else{r=parseInt(t*1e3,10);o="m"}return r+o}else{return"?"}}}})();(function(){angular.module("townReportApp").filter("addHtmlLineBreaks",e);function e(){return function(e){var t=e.replace(/\n/g,"<br/>");return t}}})();(function(){angular.module("townReportApp").filter("customSearch",e);function e(){return function(e,t){var r=[];if(typeof t===undefined||t==="")return e;var o=new RegExp(t,"i");for(var n=0;n<e.length;n++){var a=e[n];if(o.test(a.name)||o.test(a.category)||o.test(a.state)||o.test(a.desc)||o.test(a.address)){r.push(a)}}return r}}})();(function(){angular.module("townReportApp").directive("ratingStars",e);function e(){return{restrict:"EA",scope:{thisRating:"=rating"},templateUrl:"/common/directives/ratingStars/ratingStars.template.html"}}})();(function(){angular.module("townReportApp").directive("footerGeneric",e);function e(){return{restrict:"EA",templateUrl:"/common/directives/footerGeneric/footerGeneric.template.html"}}})();(function(){angular.module("townReportApp").directive("navigation",e);function e(){return{restrict:"EA",templateUrl:"/common/directives/navigation/navigation.template.html",controller:"navigationCtrl as navvm"}}})();(function(){angular.module("townReportApp").controller("navigationCtrl",e);e.$inject=["$location","authentication"];function e(e,t){var r=this;r.currentPath=e.path();r.isLoggedIn=t.isLoggedIn();r.currentUser=t.currentUser();r.logout=function(){t.logout();e.path("/")}}})();(function(){angular.module("townReportApp").directive("pageHeader",e);function e(){return{restrict:"EA",scope:{content:"=content"},templateUrl:"/common/directives/pageHeader/pageHeader.template.html"}}})();